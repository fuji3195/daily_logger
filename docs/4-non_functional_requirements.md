# 4. 非機能要件

| 区分             | 要件名        | 指標・具体値                                                                     | 補足 / 追加理由          |
| -------------- | ---------- | -------------------------------------------------------------------------- | ------------------ |
| **UX**         | オフラインファースト | 100 % 機能が通信不要／バックログキュー最大 1 MB                                              | 現状維持               |
|                | アクセシビリティ   | WCAG 2.2 AA 準拠・TalkBack/VoiceOver 操作達成率 100 %                              | 現状維持               |
|                | ローカライズ     | `ja`, `en-US`（Intl ARB）初期、後続言語は 1 週間で追加可能な IA                              | ―                  |
| **性能**         | レイテンシ      | _P50_ 入力 ≤ **100 ms**, _P95_ ≤ 250 ms初期ダッシュボード描画 ≤ 300 ms                  | P95 を追加            |
|                | スループット     | 同時 100 req/s で P95 ≤ 500 ms（API 単体）                                        | スケール試験指標           |
|                | バッテリー      | バックグラウンド同期最短 15 min／1 回、リトライ 3 回で停止                                        | リトライ制限を追記          |
|                | アプリサイズ     | Android < 40 MB, iOS < 50 MB (リリースビルド)                                     | ストア掲載基準            |
| **セキュリティ**     | 通信         | HTTPS/TLS1.2+（HSTS, TLS_AEAD 系）                                            | —                  |
|                | 認証         | JWT + Refresh（90 日失効）／PKCE-OAuth 対応                                        | Refresh 設定を具体化     |
|                | データ保護      | - **At-rest**: SQLite & PG 共に AES-256（pgcrypto / SQLCipher）- 個人データはログに残さない | 新規                 |
|                | 規格遵守       | OWASP **MASVS-L2** (モバイル) + **ASVS-L1** (API)                              | モバイル向け規格を昇格        |
| **信頼性**        | データ競合      | Last-write-wins + マージ UI、※同期衝突率 < 0.1 %                                    | 目標値を追加             |
|                | 可用性        | API **99.9 %** /month, モバイル起動成功 **99.5 %**                                 | SLA/SLOを明示         |
|                | DR/バックアップ  | DB フルバックアップ 1 日1回、保持 30 日、RTO 4 h                                          | FR-10 と整合          |
| **テスト品質**      | カバレッジ      | Unit 行網羅 ≥ 80 %、Widget ≥ 60 %、E2E シナリオ 15 本                                | レイヤ別に定義            |
|                | 静的解析       | Dart `flutter analyze`, Python `ruff` WSL 0                                | Maintainability 指標 |
| **運用監視**       | ロギング       | 構造化 JSON ログ（request_id, user_id hash, latency）                             | 新規                 |
|                | モニタリング     | Prometheus + Grafana：CPU/メモリ/95th レイテンシ可視化Sentry: Crash < 1 % DAU          | 新規                 |
| **スケーラビリティ**   | データ規模      | **1 k ユーザ × 100 k エントリ** /ユーザで P95 < 500 ms                                | 現状維持               |
|                | パーティション    | Entry 月次 RANGE、自動 24 か月保持・古い月は圧縮                                           | 将来対策               |
| **CI/CD**      | パイプライン     | `main` マージで Dev deploy, `v*` タグで Prod; 実行時間 ≤ 15 min                       | ―                  |
| **メンテナンス**     | アーキテクチャ    | Clean Architecture + Riverpod (Domain/Data/UI 階層)                          | 現状維持               |
|                | API バージョン  | `/v{n}` パス固定、後方互換維持期間 12 か月                                                | FR-21 と紐付け         |
| **法令**         | プライバシー     | GDPR / 改正個人情報保護法 対応（削除要請 ≤ 30 日）                                           | 新規                 |
| **Rate-Limit** | API 制限     | デフォルト 100 req/min・429 応答 < 0.5 %                                           | FR-18 と紐付け         |
